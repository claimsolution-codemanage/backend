<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Invoice</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito&display=swap');

        body {
            margin-top: 20px;
            background-color: #eee;
        }

        .card {
            box-shadow: 0 20px 27px 0 rgb(0 0 0 / 5%);
        }

        .card {
            position: relative;
            display: flex;
            flex-direction: column;
            min-width: 0;
            word-wrap: break-word;
            background-color: #fff;
            background-clip: border-box;
            border: 0 solid rgba(0, 0, 0, .125);
            border-radius: 1rem;
        }
        .container-full{
            min-height: 90vh;
        }
        .icon{
            font-size: 8rem;
        }
    </style>
    <script>
        console.log("calling confirm")
    </script>

</head>

<body>
    <div class="container w-100">
        <div class="row">
            <div class="col-lg-12">
                <div class="card container-full">

                    <div id="confirm-container" class="card-body d-flex flex-column align-items-center justify-content-center">
                        <i id="icon" class="bi bi-compass icon"></i>
                        <p id="iconText" class="fs-5"><%= message%></p>
                        <p id="loading">Confirming...</p>
                     </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>
        <script>
            console.log("calling script");
            const icon = document.getElementById('icon');
            const iconText = document.getElementById('iconText');
            const iconContainer = document.getElementById('confirm-container');
            const loadingText = document.getElementById('loading');
        
            const fetchConfirmation = async () => {
                try {
                    const res = await fetch(`<%= apiBase %>/api/payment/confirmation?data=<%= encResponse%>`);
                    console.log("calling api",res);
                    if (res.status === 200) {
                        iconContainer.classList.remove('text-danger');
                        iconContainer.classList.add('text-success');
                        icon.classList.remove('bi-compass');
                        icon.classList.add('bi-patch-check');
                        iconText.innerText = res.data.message || "Payment successful!";
                    } else {
                        iconText.innerText = "Payment failed!";
                    }
                } catch (error) {
                    console.log("eroor",error);
                    iconContainer.classList.remove('text-success');
                    iconContainer.classList.add('text-danger');
                    icon.classList.remove('bi-compass');
                    icon.classList.add('bi-exclamation-triangle');
                    iconText.innerText = error.response?.data?.message || "Error processing payment!";
                } finally {
                    loadingText.innerText = "Re-directing...";
                    setTimeout(function () {
                        window.location.href = '<%= redirectUrl %>';
                    }, 3000);
                }
            }
        </script>
        
        
</body>

</html>